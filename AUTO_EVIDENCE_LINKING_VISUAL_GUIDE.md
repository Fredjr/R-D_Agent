# ðŸ¤– Automatic Evidence Linking - Visual Guide

## What You're Missing (And How to Get It)

### âŒ Current State (Feature Disabled)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ðŸ“¥ Smart Inbox - Paper Triaged                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Title: MEK-SHP2 inhibition in treating CPT                  â”‚
â”‚ Relevance: 85/100                                           â”‚
â”‚                                                              â”‚
â”‚ âœ¨ Evidence from Paper (2)                                  â”‚
â”‚   "Congenital pseudarthrosis of the tibia (CPT)..."        â”‚
â”‚   Linked to: Hypothesis H1                                  â”‚
â”‚                                                              â”‚
â”‚ ðŸ”¬ Hypothesis Relevance Breakdown (1)                       â”‚
â”‚   Hypothesis H1: Score 75/100 (supports)                    â”‚
â”‚                                                              â”‚
â”‚ [Accept] [Maybe] [Reject]                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

                        â¬‡ï¸ BUT...

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ðŸ”¬ Research Questions Tab - Hypothesis H1                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Hypothesis: Kinase inhibitors treat rare bone diseases      â”‚
â”‚ Status: Proposed                                            â”‚
â”‚ Confidence: 0                                               â”‚
â”‚                                                              â”‚
â”‚ Evidence: 0 supporting, 0 contradicting                     â”‚
â”‚ âŒ NO EVIDENCE LINKS CREATED                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### âœ… After Enabling (Feature Enabled)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ðŸ“¥ Smart Inbox - Paper Triaged                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Title: MEK-SHP2 inhibition in treating CPT                  â”‚
â”‚ Relevance: 85/100                                           â”‚
â”‚                                                              â”‚
â”‚ âœ¨ Evidence from Paper (2)                                  â”‚
â”‚   "Congenital pseudarthrosis of the tibia (CPT)..."        â”‚
â”‚   Linked to: Hypothesis H1                                  â”‚
â”‚                                                              â”‚
â”‚ ðŸ”¬ Hypothesis Relevance Breakdown (1)                       â”‚
â”‚   Hypothesis H1: Score 75/100 (supports)                    â”‚
â”‚                                                              â”‚
â”‚ [Accept] [Maybe] [Reject]                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

                        â¬‡ï¸ AUTOMATICALLY...

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ðŸ”¬ Research Questions Tab - Hypothesis H1                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Hypothesis: Kinase inhibitors treat rare bone diseases      â”‚
â”‚ Status: Testing â¬…ï¸ UPDATED!                                 â”‚
â”‚ Confidence: 45 â¬…ï¸ CALCULATED!                               â”‚
â”‚                                                              â”‚
â”‚ Evidence: 1 supporting, 0 contradicting â¬…ï¸ INCREMENTED!     â”‚
â”‚                                                              â”‚
â”‚ ðŸ“„ MEK-SHP2 inhibition in treating CPT                      â”‚
â”‚    âœ… Supports  ðŸ’ª Strong  ðŸ¤– AI-Generated â¬…ï¸ NEW BADGE!    â”‚
â”‚    "The study found that MEK-SHP2 inhibition..."           â”‚
â”‚    [View Paper] [Remove]                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## How It Works

### Step 1: User Triages Paper
```
User clicks "Triage with AI" on a paper
         â¬‡ï¸
AI analyzes paper against hypotheses
         â¬‡ï¸
Returns hypothesis_relevance_scores:
{
  "hyp-123": {
    "score": 75,
    "support_type": "supports",
    "reasoning": "...",
    "evidence": "The study found..."
  }
}
```

### Step 2: Auto Evidence Linking (If Enabled)
```
IF AUTO_EVIDENCE_LINKING = true:
  FOR EACH hypothesis with score >= 40:
    âœ… Create hypothesis_evidence record
       - evidence_type: "supports" (from support_type)
       - strength: "strong" (from score 75)
       - key_finding: "The study found..."
       - added_by: NULL (AI-generated)
    
    âœ… Update hypothesis evidence counts
       - supporting_evidence_count += 1
```

### Step 3: Auto Status Update (If Enabled)
```
IF AUTO_HYPOTHESIS_STATUS = true:
  âœ… Calculate new confidence level
     - Based on supporting vs contradicting evidence
     - Formula: (supporting - contradicting) / total * 100
  
  âœ… Update hypothesis status
     - proposed â†’ testing (if evidence > 0)
     - testing â†’ supported (if confidence > 70)
     - testing â†’ rejected (if contradicting > supporting)
```

## UI Changes

### Hypothesis Card - Evidence Section

**Before:**
```
Evidence: 0 supporting, 0 contradicting
[No evidence linked yet]
```

**After:**
```
Evidence: 1 supporting, 0 contradicting

ðŸ“„ MEK-SHP2 inhibition in treating CPT
   âœ… Supports  ðŸ’ª Strong
   "The study found that MEK-SHP2 inhibition..."
   [View Paper] [Remove]
```

**With AI Badge (NEW):**
```
Evidence: 1 supporting, 0 contradicting

ðŸ“„ MEK-SHP2 inhibition in treating CPT
   âœ… Supports  ðŸ’ª Strong  ðŸ¤– AI-Generated  â¬…ï¸ NEW!
   "The study found that MEK-SHP2 inhibition..."
   [View Paper] [Remove]
```

## Feature Flags

### Backend (Railway)
```bash
# Add these environment variables in Railway dashboard:
AUTO_EVIDENCE_LINKING=true    # Enable automatic evidence linking
AUTO_HYPOTHESIS_STATUS=true   # Enable automatic status updates
```

### How to Check if Enabled
```bash
# Check Railway logs for:
ðŸ”§ AUTO_EVIDENCE_LINKING = True
ðŸ”§ AUTO_HYPOTHESIS_STATUS = True

# If you see:
ðŸ”§ AUTO_EVIDENCE_LINKING = False  â¬…ï¸ DISABLED!
```

## Quick Enable Checklist

- [ ] Go to Railway dashboard (https://railway.app/)
- [ ] Select R-D_Agent backend project
- [ ] Click "Variables" tab
- [ ] Add `AUTO_EVIDENCE_LINKING=true`
- [ ] Add `AUTO_HYPOTHESIS_STATUS=true`
- [ ] Wait for automatic redeploy (~2-3 min)
- [ ] Check logs for "AUTO_EVIDENCE_LINKING = True"
- [ ] Triage a paper to test
- [ ] Check hypothesis evidence section
- [ ] Look for ðŸ¤– AI-Generated badge

## Expected Behavior

### When You Triage a Paper:

1. **Inbox shows triage results** âœ… (Already working)
   - Evidence excerpts
   - Hypothesis relevance scores
   - Collection suggestions

2. **Evidence links created automatically** âŒ (Needs feature flag)
   - One link per hypothesis with score >= 40
   - Support type mapped from AI analysis
   - Strength calculated from score
   - Added_by = NULL (AI-generated)

3. **Hypothesis status updated** âŒ (Needs feature flag)
   - Status: proposed â†’ testing
   - Confidence: calculated from evidence
   - Evidence counts: incremented

4. **UI shows AI badge** âœ… (Code deployed, waiting for data)
   - ðŸ¤– AI-Generated badge appears
   - Only for evidence with added_by = NULL

## Troubleshooting

### "I enabled the flags but nothing happens"

**Check 1:** Railway logs show feature enabled?
```bash
# Look for this in logs:
ðŸ”§ AUTO_EVIDENCE_LINKING = True  âœ…
```

**Check 2:** Triage a NEW paper (not already triaged)
- Feature only works on NEW triage operations
- Re-triaging existing papers won't create duplicate links

**Check 3:** Hypothesis score >= 40?
- Only creates links for scores >= 40
- Check inbox "Hypothesis Relevance Breakdown" section

### "I see evidence but no AI badge"

**Check 1:** Frontend deployed?
- Verify Vercel deployment completed
- Hard refresh browser (Cmd+Shift+R)

**Check 2:** Evidence has NULL added_by?
```sql
SELECT added_by FROM hypothesis_evidence WHERE id = <id>;
-- Should return NULL for AI-generated
```

## Summary

**Problem:** Evidence shown in inbox but not saved to hypotheses
**Root Cause:** Feature flag `AUTO_EVIDENCE_LINKING=false` by default
**Solution:** Enable flag in Railway + deploy frontend changes
**Result:** ðŸ¤– AI automatically links evidence to hypotheses after triage

